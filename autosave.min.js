!function(){function e(){return(new Date).getTime()}function t(){var e={},t=document.querySelectorAll("[name=linkform] [name]");for(var n in t){var a=t[n].name;["save_edit","cancel_edit","delete_link","token","returnurl"].indexOf(a)<0&&("string"==typeof a&&a.length>0&&("checkbox"===t[n].type?e[a]=t[n].checked:"radio"===t[n].type?t[n].checked&&(e[a]=t[n].value):e[a]=t[n].value),e[a]&&(e[a]=e[a]))}return e}function n(){return v+document.querySelector("[name="+s+"]").value}function a(){return localStorage.hasOwnProperty(n())}function o(){var e=r(),n=t();return delete e._autosaveTime,delete n.item,JSON.stringify(e)!==JSON.stringify(n)}function r(e){if(e||(e=n()),a(e))return JSON.parse(localStorage.getItem(e))}function i(){var a=t();a._autosaveTime=e();var o=n();"string"==typeof o&&o.length>v.length&&"object"==typeof a&&(localStorage.setItem(o.trim(),JSON.stringify(a)),console.log("Data saved")),c()}function l(){var e=document.querySelectorAll("[name="+f+"] [name]"),t=r();if(t)for(var n in e){var a=e[n],o=a.name;t.hasOwnProperty(o)&&("checkbox"===a.type?a.checked=t[o]:"radio"===a.type?a.value===t[o]&&(a.checked=!0):a.value=t[o])}}function c(){for(key in localStorage)if(0===key.indexOf(v)){var t=r(key);e()-t._autosaveTime>m&&(localStorage.removeItem(key),console.log("Key "+key+" removed."))}}var u=window.autosaveInterval||30,m=window.autosaveLifetime||18e3,f="linkform",s="lf_url",v="autosave_";!function(){if(u*=1e3,m*=1e3,document.querySelector("[name="+f+"]")&&document.querySelector("[name="+s+"]")){if(a()){var e=r(),t=new Date(e._autosaveTime),n=t.toLocaleDateString()+" "+t.toLocaleTimeString();o()&&confirm("An existing draft from "+n+" has been found for this link. Do you want to load it? Otherwise, this draft will be complitely erased.")&&l()}setInterval(function(){i()},u),document.querySelector("[name="+f+"]").addEventListener("submit",function(){i()})}else console.error("Shaarli autosave plugin has incorrect parameters. Try removing parameters autosave_FORMNAME and autosave_KEYNAME via the plugin administration.")}()}();