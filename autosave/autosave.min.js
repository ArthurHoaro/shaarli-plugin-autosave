!function(){function e(){if(u*=1e3,m*=1e3,!document.querySelector("[name="+v+"]")||!document.querySelector("[name="+f+"]"))return void console.error("Shaarli autosave plugin has incorrect parameters. Try removing parameters autosave_FORMNAME and autosave_KEYNAME via the plugin administration.");if(a()){var e=r(),t=new Date(e._autosaveTime),n=t.toLocaleDateString()+" "+t.toLocaleTimeString();confirm("An existing draft from "+n+" has been found for this link. Do you want to load it? Otherwise, this draft will be complitely erased.")&&c()}setInterval(function(){i()},u),document.querySelector("[name="+v+"]").addEventListener("submit",function(){i()})}function t(){return(new Date).getTime()}function n(){var e={},t=document.querySelectorAll("[name=linkform] [name]");for(var n in t){var o=t[n].name;["save_edit","cancel_edit","delete_link","token"].indexOf(o)<0&&"string"==typeof o&&o.length>0&&("checkbox"===t[n].type?e[o]=t[n].checked:"radio"===t[n].type?t[n].checked&&(e[o]=t[n].value):e[o]=t[n].value)}return e}function o(){return s+document.querySelector("[name="+f+"]").value}function a(){return localStorage.hasOwnProperty(o())}function r(e){return e||(e=o()),a(e)?JSON.parse(localStorage.getItem(e)):void 0}function i(){var e=n();e._autosaveTime=t();var a=o();"string"==typeof a&&a.length>s.length&&"object"==typeof e&&(localStorage.setItem(a.trim(),JSON.stringify(e)),console.log("Data saved")),l()}function c(){var e=document.querySelectorAll("[name="+v+"] [name]"),t=r();if(t)for(var n in e){var o=e[n],a=o.name;t.hasOwnProperty(a)&&("checkbox"===o.type?o.checked=t[a]:"radio"===o.type?o.value===t[a]&&(o.checked=!0):o.value=t[a])}}function l(){for(key in localStorage)if(0===key.indexOf(s)){var e=r(key);t()-e._autosaveTime>m&&(localStorage.removeItem(key),console.log("Key "+key+" removed."))}}var u=window.autosaveInterval||30,m=window.autosaveLifetime||18e3,v="linkform",f="lf_url",s="autosave_";e()}();