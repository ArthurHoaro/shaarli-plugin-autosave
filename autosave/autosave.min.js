!function(){function e(){if(u*=1e3,s*=1e3,!document.querySelector("[name="+m+"]")||!document.querySelector("[name="+v+"]"))return void console.error("Shaarli autosave plugin has incorrect parameters. Try removing parameters autosave_FORMNAME and autosave_KEYNAME via the plugin administration.");if(o()){var e=r(),t=new Date(e._autosaveTime),a=t.toLocaleDateString()+" "+t.toLocaleTimeString();confirm("An existing draft from "+a+" has been found for this link. Do you want to load it? Otherwise, this draft will be complitely erased.")&&c()}setInterval(function(){i()},u)}function t(){return(new Date).getTime()}function a(){var e={},t=document.querySelectorAll("[name=linkform] [name]");for(var a in t){var n=t[a].name;["save_edit","cancel_edit","delete_link","token"].indexOf(n)<0&&"string"==typeof n&&n.length>0&&("checkbox"===t[a].type?e[n]=t[a].checked:"radio"===t[a].type?t[a].checked&&(e[n]=t[a].value):e[n]=t[a].value)}return e}function n(){return d+document.querySelector("[name="+v+"]").value}function o(){return localStorage.hasOwnProperty(n())}function r(e){return e||(e=n()),o(e)?JSON.parse(localStorage.getItem(e)):void 0}function i(){var e=a();e._autosaveTime=t();var o=n();"string"==typeof o&&o.length>d.length&&"object"==typeof e&&(localStorage.setItem(o.trim(),JSON.stringify(e)),console.log("Data saved")),l()}function c(){var e=document.querySelectorAll("[name="+m+"] [name]"),t=r();if(t)for(var a in e){var n=e[a],o=n.name;t.hasOwnProperty(o)&&("checkbox"===n.type?n.checked=t[o]:"radio"===n.type?n.value===t[o]&&(n.checked=!0):n.value=t[o])}document.getElementsByName(m)[0].dispatchEvent(f)}function l(){for(key in localStorage)if(0===key.indexOf(d)){var e=r(key);t()-e._autosaveTime>s&&(localStorage.removeItem(key),console.log("Key "+key+" removed."))}}var u=window.autosaveInterval||30,m=window.autosaveFormname||"linkform",v=window.autosaveKeyname||"lf_url",s=window.autosaveLifetime||18e3,d="autosave_",f=document.createEvent("Event");f.initEvent("autosaveload",!0,!0),e()}();