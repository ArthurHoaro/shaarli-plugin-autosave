!function(){function e(){if(m*=1e3,f*=1e3,!document.querySelector("[name="+v+"]")||!document.querySelector("[name="+s+"]"))return void console.error("Shaarli autosave plugin has incorrect parameters. Try removing parameters autosave_FORMNAME and autosave_KEYNAME via the plugin administration.");if(o()){var e=i(),t=new Date(e._autosaveTime),n=t.toLocaleDateString()+" "+t.toLocaleTimeString();r()&&confirm("An existing draft from "+n+" has been found for this link. Do you want to load it? Otherwise, this draft will be complitely erased.")&&u()}setInterval(function(){l()},m),document.querySelector("[name="+v+"]").addEventListener("submit",function(){l()})}function t(){return(new Date).getTime()}function n(){var e={},t=document.querySelectorAll("[name=linkform] [name]");for(var n in t){var a=t[n].name;["save_edit","cancel_edit","delete_link","token","returnurl"].indexOf(a)<0&&"string"==typeof a&&a.length>0&&("checkbox"===t[n].type?e[a]=t[n].checked:"radio"===t[n].type?t[n].checked&&(e[a]=t[n].value):e[a]=t[n].value)}return e}function a(){return d+document.querySelector("[name="+s+"]").value}function o(){return localStorage.hasOwnProperty(a())}function r(){var e=i(),t=n();return delete e._autosaveTime,delete t.item,JSON.stringify(e)!==JSON.stringify(t)}function i(e){return e||(e=a()),o(e)?JSON.parse(localStorage.getItem(e)):void 0}function l(){var e=n();e._autosaveTime=t();var o=a();"string"==typeof o&&o.length>d.length&&"object"==typeof e&&(localStorage.setItem(o.trim(),JSON.stringify(e)),console.log("Data saved")),c()}function u(){var e=document.querySelectorAll("[name="+v+"] [name]"),t=i();if(t)for(var n in e){var a=e[n],o=a.name;t.hasOwnProperty(o)&&("checkbox"===a.type?a.checked=t[o]:"radio"===a.type?a.value===t[o]&&(a.checked=!0):a.value=t[o])}}function c(){for(key in localStorage)if(0===key.indexOf(d)){var e=i(key);t()-e._autosaveTime>f&&(localStorage.removeItem(key),console.log("Key "+key+" removed."))}}var m=window.autosaveInterval||30,f=window.autosaveLifetime||18e3,v="linkform",s="lf_url",d="autosave_";e()}();