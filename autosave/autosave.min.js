!function(){function e(){if(m*=1e3,f*=1e3,!document.querySelector("[name="+v+"]")||!document.querySelector("[name="+s+"]"))return void console.error("Shaarli autosave plugin has incorrect parameters. Try removing parameters autosave_FORMNAME and autosave_KEYNAME via the plugin administration.");if(a()){var e=i(),t=new Date(e._autosaveTime),n=t.toLocaleDateString()+" "+t.toLocaleTimeString();o()&&confirm("An existing draft from "+n+" has been found for this link. Do you want to load it? Otherwise, this draft will be complitely erased.")&&u()}setInterval(function(){l()},m),document.querySelector("[name="+v+"]").addEventListener("submit",function(){l()})}function t(){return(new Date).getTime()}function n(){var e={},t=document.querySelectorAll("[name=linkform] [name]");for(var n in t){var r=t[n].name;["save_edit","cancel_edit","delete_link","token","returnurl"].indexOf(r)<0&&("string"==typeof r&&r.length>0&&("checkbox"===t[n].type?e[r]=t[n].checked:"radio"===t[n].type?t[n].checked&&(e[r]=t[n].value):e[r]=t[n].value),e[r]&&(e[r]=e[r].trim()))}return e}function r(){return d+document.querySelector("[name="+s+"]").value}function a(){return localStorage.hasOwnProperty(r())}function o(){var e=i(),t=n();return delete e._autosaveTime,delete t.item,JSON.stringify(e)!==JSON.stringify(t)}function i(e){return e||(e=r()),a(e)?JSON.parse(localStorage.getItem(e)):void 0}function l(){var e=n();e._autosaveTime=t();var a=r();"string"==typeof a&&a.length>d.length&&"object"==typeof e&&(localStorage.setItem(a.trim(),JSON.stringify(e)),console.log("Data saved")),c()}function u(){var e=document.querySelectorAll("[name="+v+"] [name]"),t=i();if(t)for(var n in e){var r=e[n],a=r.name;t.hasOwnProperty(a)&&("checkbox"===r.type?r.checked=t[a]:"radio"===r.type?r.value===t[a]&&(r.checked=!0):r.value=t[a])}}function c(){for(key in localStorage)if(0===key.indexOf(d)){var e=i(key);t()-e._autosaveTime>f&&(localStorage.removeItem(key),console.log("Key "+key+" removed."))}}var m=window.autosaveInterval||30,f=window.autosaveLifetime||18e3,v="linkform",s="lf_url",d="autosave_";e()}();